PROJECT( SBOL )
CMAKE_MINIMUM_REQUIRED( VERSION 2.8 )

# folder structure
SET( SBOL_ROOT_DIR          ${SBOL_SOURCE_DIR}/..     )
SET( SBOL_BUILD_DIR         ${SBOL_ROOT_DIR}/build    )
SET( SBOL_SCHEMA_DIR        ${SBOL_ROOT_DIR}/schemas  )
SET( SBOL_TEST_DIR          ${SBOL_ROOT_DIR}/tests    )
SET( SBOL_EXAMPLE_DIR       ${SBOL_ROOT_DIR}/examples )
SET( SBOL_RELEASE_DIR       ${SBOL_ROOT_DIR}/release  )
SET( EXECUTABLE_OUTPUT_PATH ${SBOL_RELEASE_DIR}       )
SET( LIBRARY_OUTPUT_PATH    ${SBOL_RELEASE_DIR}       )

# libxml2
IF( WIN32 )
	ADD_SUBDIRECTORY( libxml2 )
	INCLUDE_DIRECTORIES( ${SBOL_SOURCE_DIR}/libxml2/include )
ELSE()
	FIND_PACKAGE( LibXml2 )
	INCLUDE_DIRECTORIES( ${LIBXML2_INCLUDE_DIR} )
ENDIF()

# libsbol
OPTION(SBOL_DEBUG "Compile with debug statements" ON)
IF( SBOL_DEBUG )
	SET(SBOL_DEBUG_ACTIVE 1)
ELSE()
	SET(SBOL_DEBUG_ACTIVE 0)
ENDIF()
CONFIGURE_FILE(
	${SBOL_SOURCE_DIR}/debug.h.in
	${SBOL_SOURCE_DIR}/debug.h
)
FILE( GLOB SBOL_SOURCE_FILES
	${SBOL_SOURCE_DIR}/*.h
	${SBOL_SOURCE_DIR}/*.c
)
ADD_LIBRARY( sbol
	SHARED
	${SBOL_SOURCE_FILES}
)
TARGET_LINK_LIBRARIES( sbol
	xml2
)
INCLUDE_DIRECTORIES(
	${SBOL_SOURCE_DIR}
	${SBOL_TEST_DIR}
)

# examples
FILE( GLOB SBOL_EXAMPLE_TARGETS
	${SBOL_EXAMPLE_DIR}/sbol_parse.c
	${SBOL_EXAMPLE_DIR}/sbol_print.c
	${SBOL_EXAMPLE_DIR}/sbol_rondtrip.c
	${SBOL_EXAMPLE_DIR}/sbol_same.c
	${SBOL_EXAMPLE_DIR}/sbol_validate.c
)
FOREACH( TARGET ${SBOL_EXAMPLE_TARGETS} )
	GET_FILENAME_COMPONENT( BASENAME ${TARGET} NAME_WE )
	ADD_EXECUTABLE( ${BASENAME}
		${SBOL_SOURCE_FILES}
		${TARGET}
	)
	TARGET_LINK_LIBRARIES( ${BASENAME} sbol )
ENDFOREACH()

# tests
FILE( GLOB SBOL_TEST_FILES
	${SBOL_TEST_DIR}/*.h
	${SBOL_TEST_DIR}/*.c
)
FILE( GLOB SBOL_TEST_TARGETS
	${SBOL_TEST_DIR}/test_all.c
)
FOREACH( TARGET ${SBOL_TEST_TARGETS} )
	GET_FILENAME_COMPONENT( BASENAME ${TARGET} NAME_WE )
	ADD_EXECUTABLE( ${BASENAME}
		${SBOL_SOURCE_FILES}
		${SBOL_TEST_FILES}
		${TARGET}
	)
	TARGET_LINK_LIBRARIES( ${BASENAME} sbol )
ENDFOREACH()
